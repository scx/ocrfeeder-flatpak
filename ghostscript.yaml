name: ghostscript
config-opts:
  - --enable-dynamic
  - --disable-cups
  - --disable-dbus
  - --disable-gtk
  - --with-system-libtiff
  - --with-drivers=FILES
# https://github.com/flathub/flathub/pull/825#issuecomment-457206134
# https://flathub.org/builds/#/builders/36/builds/687
# https://github.com/imagemin/optipng-bin/issues/97#issue-317622868
# https://discourse.libsdl.org/t/ndk-sdl2-image-libpng-build-error-png-init-filter-functions-neon/24947/3
build-options:
  arch:
    aarch64:
      cppflags: -DPNG_ARM_NEON_OPT=0
sources:
  - type: archive
    url: https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs950/ghostscript-9.50.tar.xz
    sha256: db9bb0817b6f22974e6d5ad751975f346420c2c86a0afcfe6b4e09c47803e7d4
  # Fix for CVE-2019-14869
  # https://git.ghostscript.com/?p=ghostpdl.git;a=commitdiff;h=485904772c5f
  # https://src.fedoraproject.org/rpms/ghostscript/blob/577ec8f749c409b4e40d311e369c406dd8fa7b6b/f/ghostscript-cve-2019-14869.patch
  - type: patch
    path: ghostscript-cve-2019-14869.patch
  # Make sure dvipdf is being run securely
  # https://src.fedoraproject.org/rpms/ghostscript/raw/577ec8f749c409b4e40d311e369c406dd8fa7b6b/f/ghostscript-9.23-100-run-dvipdf-securely.patch
  - type: patch
    path: ghostscript-9.50-run-dvipdf-securely.patch
post-install:
  - install -p -D -m 0644 "LICENSE" -t "${FLATPAK_DEST}/share/licenses/ghostscript/";
cleanup:
  - /share/doc
